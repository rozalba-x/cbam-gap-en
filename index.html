<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CBAM Gap Analysis Template</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Poppins', sans-serif;
      line-height:1.6; background:white;
      min-height:100vh; color:#000;
    }
    .container { max-width:1400px; margin:0 auto; padding:20px; }
    .header { background:white; border-radius:15px; padding:30px; text-align:center; margin-bottom:30px; box-shadow:0 10px 30px rgba(6,4,150,0.1); border:2px solid #060496; }
    .header h1 { color:#060496; font-size:2.5em; margin-bottom:10px; font-weight:700; }

    .deadline-warning{
      background:#060496; color:white; padding:15px; border-radius:10px;
      margin:20px 0; text-align:center; font-weight:600; font-size:1.1em;
    }

    .financial-projection{ background:#060496; color:white; padding:25px; border-radius:15px; margin:20px 0; }
    .projection-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin:20px 0; }
    .projection-card{ background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; border-left:5px solid #fff; }

    .export-advantage{ background:#060496; color:white; padding:25px; border-radius:15px; margin:20px 0; }

    .sector-selector{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; margin-bottom:30px; }
    .sector-btn{
      background:white; border:3px solid #e0e0e0; border-radius:15px; padding:20px; text-align:center; cursor:pointer;
      transition:all .3s ease; box-shadow:0 5px 15px rgba(0,0,0,.1);
    }
    .sector-btn:hover, .sector-btn.active{ border-color:#060496; background:#f8f9fa; transform:translateY(-2px); }
    .sector-icon{ font-size:2em; margin-bottom:10px; }

    .gap-analysis{ background:white; border-radius:15px; padding:30px; margin:20px 0; box-shadow:0 10px 30px rgba(6,4,150,0.1); border:2px solid #060496; display:none; }
    .gap-analysis.active{ display:block; }

    .question-block{ background:#f8f9fa; border-left:5px solid #060496; padding:20px; margin:15px 0; border-radius:5px; }
    .question-title{ font-weight:600; color:#000; margin-bottom:10px; font-size:1.1em; }

    .status-grid{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:15px; }
    .status-option{ padding:10px; border-radius:8px; text-align:center; cursor:pointer; border:2px solid transparent; transition:all .3s ease; }
    .status-have{ background:#d4edda; color:#155724; }
    .status-partial{ background:#fff3cd; color:#856404; }
    .status-need{ background:#f8d7da; color:#721c24; }
    .status-option:hover, .status-option.selected{ border-color:#060496; transform:scale(1.02); }

    .company-info{ background:#f8f9fa; padding:20px; border-radius:10px; margin-bottom:20px; border:2px solid #060496; }
    .info-row{ display:grid; grid-template-columns:200px 1fr; gap:15px; margin:10px 0; align-items:center; }
    .info-label{ font-weight:600; color:#000; }
    .info-input{ padding:8px 12px; border:2px solid #060496; border-radius:5px; font-size:14px; }
    .info-input:focus{ outline:none; border-color:#060496; box-shadow:0 0 0 3px rgba(6,4,150,0.1); }
    .required{ color:#e74c3c; }

    .results-section{
      background:#060496; color:white; padding:25px; border-radius:15px; margin-top:30px;
    }
    .action-item{ background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; margin:10px 0; border-left:4px solid #fff; }
    .priority-high{ border-left-color:#e74c3c; }
    .priority-medium{ border-left-color:#f39c12; }
    .priority-low{ border-left-color:#27ae60; }

    .generate-btn{
      background:#060496; color:white; border:none; padding:15px 30px; border-radius:10px; font-size:1.1em; cursor:pointer;
      margin:20px auto; display:block; transition:all .3s ease; font-weight:600;
    }
    .generate-btn:hover{ background:#050385; transform:scale(1.05); }

    .regional-note{ background:#f8f9fa; border:2px solid #060496; padding:15px; border-radius:8px; margin:15px 0; }

    .cost-comparison{ background:#060496; color:white; padding:20px; border-radius:15px; margin:20px 0; }
    .comparison-table{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:15px 0; }
    .comparison-card{ background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; }
    
    .validation-error{ border-color:#e74c3c !important; }
    .error-message{ color:#e74c3c; font-size:12px; margin-top:5px; }

    .chart-container{ background:rgba(255,255,255,0.1); padding:25px; border-radius:10px; margin:25px 0; }
    .chart-wrapper{ position:relative; height:400px; background:white; border-radius:8px; padding:15px; }
    #projectionChart{ width:100%!important; height:100%!important; }
    
    @media (max-width:700px){ .status-grid{ grid-template-columns:1fr; } .info-row{ grid-template-columns:1fr; } .comparison-table{ grid-template-columns:1fr; } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 20px;">
        <svg width="160" height="48" viewBox="0 0 320 96" style="flex-shrink: 0;">
          <text x="0" y="65" font-family="Poppins, sans-serif" font-size="38" font-weight="400" fill="#060496">entrenovu.</text>
        </svg>
        <div style="text-align: right;">
          <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
            Powered by <a href="https://www.entrenovu.com/" target="_blank" style="color: #060496; text-decoration: none; font-weight: 500;">entrenovu</a>
          </div>
        </div>
      </div>
      <h1>◯ CBAM Gap Analysis</h1>
      <p>For Western Balkans & Non-EU Exporters to the EU</p>
    </div>

    <div class="deadline-warning">
      ⚠ CBAM Definitive Period starts January 1, 2026 - Time for preparation is running out!
    </div>

    <div class="financial-projection">
      <h2 style="margin-bottom:20px;">▲ CBAM Financial Projections 2026-2034</h2>
      <p><strong>CO₂ Price:</strong> €90/ton (2026) → €178/ton (2034) - According to market forecasts</p>

      <div class="projection-grid">
        <div class="projection-card">
          <h4>■ CBAM Costs for 9 years (Market Forecast)</h4>
          <ul style="margin:10px 0; line-height:1.8;">
            <li><strong>2026:</strong> €90/ton CO₂</li>
            <li><strong>2028:</strong> €108/ton CO₂</li>
            <li><strong>2030:</strong> €138/ton CO₂</li>
            <li><strong>2032:</strong> €158/ton CO₂</li>
            <li><strong>2034:</strong> €178/ton CO₂</li>
          </ul>
        </div>

        <div class="projection-card">
          <h4>⚖ Prepared vs. Unprepared Exporters</h4>
          <p><strong>With accurate monitoring:</strong></p>
          <ul style="line-height:1.6;">
            <li>Actual CBAM costs (lower)</li>
            <li>Competitive advantage</li>
            <li>Better relationships with importers</li>
          </ul>
          <p><strong>Without data (default values):</strong></p>
          <ul style="line-height:1.6;">
            <li>+30-50% additional CBAM costs</li>
            <li>Loss of competitiveness</li>
            <li>Risk of losing customers</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="cost-comparison">
      <h3>▼ Cost Comparison: Prepared vs. Unprepared</h3>
      <div class="comparison-table">
        <div class="comparison-card">
          <h4>✓ Companies with Actual Data (Optimized)</h4>
          <p><strong>Steel:</strong> ~2.30 ton CO₂/ton product = €207 CBAM/ton</p>
          <p><strong>Aluminum:</strong> ~10.50 ton CO₂/ton product = €945 CBAM/ton</p>
          <p><strong>Cement:</strong> ~0.85 ton CO₂/ton product = €77 CBAM/ton</p>
          <p><strong>Fertilizers:</strong> ~1.50 ton CO₂/ton product = €135 CBAM/ton</p>
        </div>
        <div class="comparison-card">
          <h4>✗ Companies Without Data (EU Default Values)</h4>
          <p><strong>Steel:</strong> ~2.80 ton CO₂/ton = €252 CBAM/ton (+22%)</p>
          <p><strong>Aluminum:</strong> ~11.50 ton CO₂/ton = €1035 CBAM/ton (+10%)</p>
          <p><strong>Cement:</strong> ~0.97 ton CO₂/ton = €87 CBAM/ton (+13%)</p>
          <p><strong>Fertilizers:</strong> ~1.72 ton CO₂/ton = €155 CBAM/ton (+15%)</p>
        </div>
      </div>
      <p style="text-align:center; margin-top:15px; font-size:1.1em;">
        <strong>▲ For 1000 tons export/year: The difference can be €10,000 - €90,000 more for those without accurate data!</strong>
      </p>
    </div>

    <div class="export-advantage">
      <h2>◆ Strategic Information for Non-EU Exporters</h2>

      <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; margin:15px 0;">
        <h3>▲ Renewable Energy Advantage</h3>
        <p><strong>Countries with clean electricity:</strong> ~0.1-0.3 kg CO₂/kWh (hydro, nuclear, renewables)</p>
        <p><strong>EU Average:</strong> ~0.4 kg CO₂/kWh</p>
        <p><strong>Competitive advantage:</strong> Up to 75% lower emissions from electricity!</p>
      </div>

      <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; margin:15px 0;">
        <h3>▲ CAUTION: Not Everything is Green!</h3>
        <p><strong>Electricity:</strong> May be clean from renewables ✓</p>
        <p><strong>Industrial processes:</strong></p>
        <ul style="line-height:1.8; margin:10px 0;">
          <li>▲ <strong>Natural gas:</strong> Must be calculated separately</li>
          <li>● <strong>Oil/Diesel:</strong> Full CO₂ costs</li>
          <li>● <strong>Coal:</strong> Very high emissions</li>
          <li>■ <strong>Chemical processes:</strong> CO₂ from reactions</li>
        </ul>
        <p style="color:#ffeb3b; font-weight:bold;">
          ⚠ Many non-EU companies make mistakes: They think renewable electricity makes them 100% green, but CBAM calculates every energy source separately!
        </p>
      </div>

      <div style="background:rgba(255,255,255,0.2); padding:20px; border-radius:10px; margin:15px 0;">
        <h3>◯ Your Competitive Edge</h3>
        <p><strong>"Separate your emissions correctly:"</strong></p>
        <ul style="line-height:1.8;">
          <li>✓ Electricity (your country's advantage)</li>
          <li>✗ Thermal energy (needs optimization)</li>
          <li>⚖ Industrial processes (specific strategies)</li>
        </ul>
        <p style="color:#4ecdc4; font-weight:bold;">▶ Result: Minimize CBAM costs by using advantages and optimizing weaknesses!</p>
      </div>
    </div>

    <!-- Company info -->
    <div class="company-info">
      <h3 style="margin-bottom:15px; color:#000;">■ Company Information</h3>
      <div class="info-row">
        <div class="info-label">Company name: <span class="required">*</span></div>
        <div>
          <input type="text" class="info-input" id="company-name" placeholder="e.g. Balkans Steel Corp" required>
          <div class="error-message" id="company-name-error"></div>
        </div>
      </div>
      <div class="info-row">
        <div class="info-label">Main product:</div>
        <select class="info-input" id="main-product">
          <option value="">Select...</option>
          <option value="steel">Steel & Iron</option>
          <option value="aluminium">Aluminum</option>
          <option value="cement">Cement</option>
          <option value="fertilizer">Fertilizers</option>
        </select>
      </div>
      <div class="info-row">
        <div class="info-label">EU exports (tons/year): <span class="required">*</span></div>
        <div>
          <input type="number" class="info-input" id="export-volume" placeholder="e.g. 10000" required>
          <div class="error-message" id="export-volume-error"></div>
        </div>
      </div>
      <div class="info-row">
        <div class="info-label">Your name: <span class="required">*</span></div>
        <div>
          <input type="text" class="info-input" id="contact-name" placeholder="e.g. Marko Petrovic" required>
          <div class="error-message" id="contact-name-error"></div>
        </div>
      </div>
      <div class="info-row">
        <div class="info-label">Email: <span class="required">*</span></div>
        <div>
          <input type="email" class="info-input" id="contact-email" placeholder="e.g. marko@company.com" required>
          <div class="error-message" id="contact-email-error"></div>
        </div>
      </div>
      <div class="info-row">
        <div class="info-label">Main EU buyers:</div>
        <input type="text" class="info-input" id="eu-buyers" placeholder="e.g. Germany, Italy">
      </div>
    </div>

    <div class="regional-note">
      <strong>▶ Regional advantages:</strong> Western Balkans exporters often have competitive advantages in renewable electricity and can leverage their position as reliable suppliers to EU markets with proper CBAM preparation.
    </div>

    <h3 style="color:#060496; text-align:center; margin:20px 0; font-weight:600;">Select your sector for detailed analysis:</h3>

    <div class="sector-selector">
      <div class="sector-btn" data-sector="steel" onclick="showSector('steel', event)">
        <div class="sector-icon">■</div>
        <h4>Steel & Iron</h4>
        <p>Tubes, profiles, sheets</p>
      </div>
      <div class="sector-btn" data-sector="aluminium" onclick="showSector('aluminium', event)">
        <div class="sector-icon">□</div>
        <h4>Aluminum</h4>
        <p>Plates, wires, profiles</p>
      </div>
      <div class="sector-btn" data-sector="cement" onclick="showSector('cement', event)">
        <div class="sector-icon">●</div>
        <h4>Cement</h4>
        <p>Clinker, ready cement</p>
      </div>
      <div class="sector-btn" data-sector="fertilizer" onclick="showSector('fertilizer', event)">
        <div class="sector-icon">◆</div>
        <h4>Fertilizers</h4>
        <p>Nitrogen-based</p>
      </div>
    </div>

    <!-- STEEL -->
    <div id="steel-analysis" class="gap-analysis">
      <h2 style="color:#060496; margin-bottom:20px; font-weight:700;">■ Steel & Iron - CBAM Readiness Check</h2>

      <div class="question-block">
        <div class="question-title">1. Production Route & Direct Emissions (CO₂)</div>
        <p><strong>CBAM requires:</strong> Which production process? Blast furnace, electric arc, or other route?</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Documented & measurable</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Approximate estimates</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No data available</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">2. Electricity Consumption & Indirect Emissions</div>
        <p><strong>CBAM requires:</strong> kWh per ton steel + CO₂ intensity of electricity (varies by country)</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Bills & monthly measurements</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Only total consumption</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">3. Input Raw Materials</div>
        <p><strong>CBAM requires:</strong> Iron ore/coal/scrap & embedded CO₂ from suppliers.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Certificates from suppliers</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Only origin information</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No CO₂ data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">4. Communication with EU & Templates</div>
        <p><strong>CBAM requires:</strong> Completing official templates for EU importers.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Template completed</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>In progress</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>Never used it</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">5. Carbon Price in Your Country</div>
        <p><strong>CBAM advantage:</strong> Existing CO₂ payments can be deducted from CBAM.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We pay CO₂ price<br><small>Documented</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Other environmental taxes</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ No CO₂ price<br><small>Full CBAM price</small></div>
        </div>
      </div>
    </div>

    <!-- ALUMINIUM -->
    <div id="aluminium-analysis" class="gap-analysis">
      <h2 style="color:#060496; margin-bottom:20px; font-weight:700;">□ Aluminum - CBAM Readiness Check</h2>

      <div class="question-block">
        <div class="question-title">1. Production Route (Primary vs. Recycling)</div>
        <p><strong>CBAM requires:</strong> Electrolysis (primary) or recycling – different CO₂ profiles.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Clear production route</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Mixed routes</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No separation</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">2. Energy Intensity</div>
        <p><strong>CBAM requires:</strong> kWh/kg aluminum + source (hydropower = major advantage).</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Certified renewable energy</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Total consumption</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">3. PFC Emissions (CF₄/C₂F₆)</div>
        <p><strong>CBAM requires:</strong> Measurement/calculation for electrolysis (primary only).</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>PFC measured</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Estimates</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No PFC data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">4. Alumina Origin</div>
        <p><strong>CBAM requires:</strong> Embedded CO₂ in imported alumina.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Data from suppliers</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Only origin</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No CO₂ data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">5. Communication with EU & Templates</div>
        <p><strong>CBAM requires:</strong> Completing official templates for EU importers.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Template completed</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>In progress</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>Never used it</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">6. Carbon Price in Your Country</div>
        <p><strong>CBAM advantage:</strong> Existing CO₂ payments can be deducted from CBAM.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We pay CO₂ price<br><small>Documented</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Other environmental taxes</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ No CO₂ price<br><small>Full CBAM price</small></div>
        </div>
      </div>
    </div>

    <!-- CEMENT -->
    <div id="cement-analysis" class="gap-analysis">
      <h2 style="color:#060496; margin-bottom:20px; font-weight:700;">● Cement - CBAM Readiness Check</h2>

      <div class="question-block">
        <div class="question-title">1. Process Emissions (Limestone Calcination)</div>
        <p><strong>CBAM requires:</strong> CO₂ from calcination CaCO₃ → CaO + CO₂ (60% of total)</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Continuous monitoring</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Periodic data</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific monitoring</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">2. Raw Material Consumption</div>
        <p><strong>CBAM requires:</strong> Amount and type of raw materials + emission factor.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Detailed recording</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>General data</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No detailed analysis</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">3. Combustion Emissions (Kiln)</div>
        <p><strong>CBAM requires:</strong> CO₂ from coal/gas/oil for heating.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Measurement and calculation</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Consumption estimates</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No CO₂ data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">4. Electricity Consumption</div>
        <p><strong>CBAM requires:</strong> kWh/ton cement (Advantage: renewable electricity)</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Production measurements</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>General consumption</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific breakdown</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">5. Alternative Waste Materials (Fly ash, Slag)</div>
        <p><strong>CBAM requires:</strong> Content and origin of supplementary materials.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Documented & measured</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Simple recording</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No CO₂ data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">6. Templates and Communication</div>
        <p><strong>CBAM requires:</strong> Completing templates for cement and clinker.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Template completed</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>In preparation</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No experience</small></div>
        </div>
      </div>
    </div>

    <!-- FERTILIZER -->
    <div id="fertilizer-analysis" class="gap-analysis">
      <h2 style="color:#060496; margin-bottom:20px; font-weight:700;">◆ Fertilizers - CBAM Readiness Check</h2>

      <div class="question-block">
        <div class="question-title">1. Ammonia Production (NH₃)</div>
        <p><strong>CBAM requires:</strong> CO₂ from natural gas reforming for hydrogen.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Measurement and carbon balance</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Estimates</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific measurement</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">2. Nitric Acid Production (HNO₃)</div>
        <p><strong>CBAM requires:</strong> N₂O emissions + CO₂ from energy.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>N₂O and CO₂ measurement</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Only CO₂</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No monitoring</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">3. Fertilizer Formulation</div>
        <p><strong>CBAM requires:</strong> Emissions from mixing, granulation and processing.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Process data</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>General estimates</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No monitoring</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">4. Energy Consumption</div>
        <p><strong>CBAM requires:</strong> kWh and heating per ton fertilizer.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Detailed measurements</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Total consumption</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No specific breakdown</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">5. Raw Materials and Precursors</div>
        <p><strong>CBAM requires:</strong> Embedded CO₂ in ammonia, nitric acid, phosphate.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Data from suppliers</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>Limited information</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No CO₂ data</small></div>
        </div>
      </div>

      <div class="question-block">
        <div class="question-title">6. Templates and Reporting</div>
        <p><strong>CBAM requires:</strong> Completing templates for each fertilizer type.</p>
        <div class="status-grid">
          <div class="status-option status-have" onclick="selectStatus(this)">✓ We have it<br><small>Complete template</small></div>
          <div class="status-option status-partial" onclick="selectStatus(this)">◐ Partially<br><small>In process</small></div>
          <div class="status-option status-need" onclick="selectStatus(this)">✗ We lack it<br><small>No experience</small></div>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="results" style="display:none;">
      <h2 style="margin-bottom:20px;">▼ CBAM Gap Analysis Results</h2>
      <div id="results-content"></div>
      
      <!-- Cost Projection Chart -->
      <div class="chart-container">
        <h3 style="margin-bottom:20px; text-align:center; color:white;">📈 CBAM Cost Projections 2026-2034</h3>
        <div class="chart-wrapper">
          <canvas id="projectionChart"></canvas>
        </div>
        <div style="margin-top:15px; font-size:0.9em; text-align:center; color:#ddd;">
          <p>💡 <strong>Note:</strong> Chart shows how CBAM costs will increase until 2034 according to market forecasts</p>
          <p>🎯 Prepared companies can save up to 20% compared to default values</p>
        </div>
      </div>
      
      <div style="text-align:center; margin-top:30px;">
        <button class="generate-btn" onclick="submitToGoogleSheets()" id="submitBtn">
          ✉️ Send Results & Request Free Consultation
        </button>
        <p style="margin-top:10px; font-size:0.9em;">Results will be sent to Entrenovu for detailed analysis</p>
      </div>
    </div>

    <button class="generate-btn" onclick="generateResults()">
      ◉ Generate Gap Analysis
    </button>
  </div>

  <!-- Chart.js for cost projection visualization -->
<!--  <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>-->
  
  <script>
    let selectedSector = '';
    let sectorData = {};
    let projectionChart = null;

    // Market carbon price forecast data
    const carbonPrices = {
      2026: 90,
      2027: 95,
      2028: 108, 
      2029: 120,
      2030: 138,
      2031: 148,
      2032: 158,
      2033: 168,
      2034: 178
    };

    function showSector(sector, event) {
      // Remove active class from all buttons
      document.querySelectorAll('.sector-btn').forEach(btn => btn.classList.remove('active'));
      
      // Hide all analyses
      document.querySelectorAll('.gap-analysis').forEach(analysis => analysis.classList.remove('active'));
      
      // Show selected analysis and activate button
      document.getElementById(sector + '-analysis').classList.add('active');
      event.currentTarget.classList.add('active');
      
      selectedSector = sector;
      
      // Update dropdown
      document.getElementById('main-product').value = sector;
    }

    function selectStatus(element) {
      // Remove selected class from siblings
      const siblings = element.parentNode.querySelectorAll('.status-option');
      siblings.forEach(sibling => sibling.classList.remove('selected'));
      
      // Add selected class to clicked element
      element.classList.add('selected');
    }

    function validateInputs() {
      let isValid = true;
      
      // Clear previous errors
      document.querySelectorAll('.info-input').forEach(input => input.classList.remove('validation-error'));
      document.querySelectorAll('.error-message').forEach(error => error.textContent = '');
      
      // Check required fields
      const requiredFields = [
        { id: 'company-name', name: 'Company name' },
        { id: 'export-volume', name: 'Export volume' },
        { id: 'contact-name', name: 'Your name' },
        { id: 'contact-email', name: 'Email' }
      ];
      
      requiredFields.forEach(field => {
        const input = document.getElementById(field.id);
        if (!input.value.trim()) {
          input.classList.add('validation-error');
          document.getElementById(field.id + '-error').textContent = field.name + ' is required';
          isValid = false;
        }
      });
      
      // Check email format
      const emailInput = document.getElementById('contact-email');
      if (emailInput.value && !emailInput.value.includes('@')) {
        emailInput.classList.add('validation-error');
        document.getElementById('contact-email-error').textContent = 'Please enter a valid email';
        isValid = false;
      }
      
      // Check if sector is selected
      if (!selectedSector) {
        alert('Please select a sector for analysis!');
        isValid = false;
      }
      
      return isValid;
    }

    function collectSectorResponses() {
      const questions = document.querySelectorAll(`#${selectedSector}-analysis .question-block`);
      const responses = [];
      
      questions.forEach((question, index) => {
        const title = question.querySelector('.question-title').textContent;
        const selected = question.querySelector('.status-option.selected');
        
        if (selected) {
          let status = 'unknown';
          if (selected.classList.contains('status-have')) status = 'have';
          else if (selected.classList.contains('status-partial')) status = 'partial';
          else if (selected.classList.contains('status-need')) status = 'need';
          
          responses.push({
            question: title,
            status: status,
            text: selected.textContent.trim()
          });
        }
      });
      
      return responses;
    }

    function generateResults() {
      if (!validateInputs()) return;
      
      const responses = collectSectorResponses();
      if (responses.length === 0) {
        alert('Please answer at least one question in the selected sector!');
        return;
      }
      
      // Calculate readiness score
      const percentage = calculateReadinessScore(responses);
      
      // Generate results
      const resultsContent = generateResultsContent(percentage, responses);
      document.getElementById('results-content').innerHTML = resultsContent;
      document.getElementById('results').style.display = 'block';
      
      // Scroll to results first
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
      
      // Generate chart with delay to ensure everything is rendered
      setTimeout(() => {
        console.log('🔄 Creating cost projection chart...');
        createCostProjectionChart(percentage);
      }, 800);
    }

    function generateResultsContent(percentage, responses) {
      const companyName = document.getElementById('company-name').value;
      const exportVolume = document.getElementById('export-volume').value;
      
      let readinessLevel = 'Low';
      let readinessColor = '#e74c3c';
      if (percentage >= 70) {
        readinessLevel = 'High';
        readinessColor = '#27ae60';
      } else if (percentage >= 40) {
        readinessLevel = 'Medium';
        readinessColor = '#f39c12';
      }
      
      let content = `
        <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:10px; margin-bottom:20px;">
          <h3>📊 CBAM Readiness Summary</h3>
          <p><strong>Company:</strong> ${companyName}</p>
          <p><strong>Sector:</strong> ${getSectorName(selectedSector)}</p>
          <p><strong>Annual export volume:</strong> ${exportVolume} tons</p>
          <p><strong>Readiness level:</strong> <span style="color:${readinessColor}; font-weight:bold;">${percentage}% - ${readinessLevel}</span></p>
        </div>
      `;
      
      // Priority actions
      const needActions = responses.filter(r => r.status === 'need');
      const partialActions = responses.filter(r => r.status === 'partial');
      
      if (needActions.length > 0) {
        content += `
          <div class="action-item priority-high">
            <h4>🚨 High Priority - Critical Actions</h4>
            <ul style="margin:10px 0; line-height:1.8;">`;
        needActions.forEach(action => {
          content += `<li>${action.question.replace(/^\d+\.\s*/, '')}</li>`;
        });
        content += `</ul>
          </div>`;
      }
      
      if (partialActions.length > 0) {
        content += `
          <div class="action-item priority-medium">
            <h4>⚠ Medium Priority - Needed Improvements</h4>
            <ul style="margin:10px 0; line-height:1.8;">`;
        partialActions.forEach(action => {
          content += `<li>${action.question.replace(/^\d+\.\s*/, '')}</li>`;
        });
        content += `</ul>
          </div>`;
      }
      
      // Cost calculation with market prices
      const estimatedCost2026 = calculateEstimatedCosts(exportVolume, percentage, 2026);
      const estimatedCost2030 = calculateEstimatedCosts(exportVolume, percentage, 2030);
      const estimatedCost2034 = calculateEstimatedCosts(exportVolume, percentage, 2034);
      
      content += `
        <div class="action-item">
          <h4>💰 CBAM Cost Estimates (Market Forecast)</h4>
          <p><strong>2026:</strong> €${estimatedCost2026.toLocaleString()} (€90/tCO₂)</p>
          <p><strong>2030:</strong> €${estimatedCost2030.toLocaleString()} (€138/tCO₂)</p>
          <p><strong>2034:</strong> €${estimatedCost2034.toLocaleString()} (€178/tCO₂)</p>
          <p style="margin-top:10px; color:#ffeb3b; font-weight:bold;">
            📈 Cost increase 2026-2034: +${Math.round(((estimatedCost2034 - estimatedCost2026) / estimatedCost2026) * 100)}%
          </p>
        </div>
      `;
      
      // Next steps
      content += `
        <div class="action-item priority-low">
          <h4>▶ Next Steps</h4>
          <ul style="margin:10px 0; line-height:1.8;">
            <li>Send results for free consultation from Entrenovu</li>
            <li>Start collecting missing data</li>
            <li>Train your team on CBAM requirements</li>
            <li>Create preparation plan until January 2026</li>
            <li>Optimize processes to minimize CBAM costs</li>
          </ul>
          <p style="margin-top:15px;"><strong>📞 Contact:</strong> info@entrenovu.com</p>
        </div>
      `;
      
      return content;
    }

    function getSectorName(sector) {
      const names = {
        'steel': 'Steel & Iron',
        'aluminium': 'Aluminum', 
        'cement': 'Cement',
        'fertilizer': 'Fertilizers'
      };
      return names[sector] || sector;
    }

    function calculateEstimatedCosts(volume, readinessPercentage, year = 2026) {
      // Updated with official EU Commission default values
      const sectorDefaultValues = {
        'steel': 2.80,      // tCO2 per ton - EU official average
        'aluminium': 11.50, // tCO2 per ton - EU official average  
        'cement': 0.97,     // tCO2 per ton - EU official average
        'fertilizer': 1.72  // tCO2 per ton - EU official average
      };
      
      const co2Price = carbonPrices[year] || 90; // Use market prices
      const co2PerTon = sectorDefaultValues[selectedSector] || 2.00;
      let baseCost = volume * co2PerTon * co2Price;
      
      // If well-prepared, companies can achieve 10-20% below default values
      if (readinessPercentage >= 80) {
        baseCost *= 0.85; // 15% reduction for excellent preparation
      } else if (readinessPercentage >= 60) {
        baseCost *= 0.90; // 10% reduction for good preparation
      } else if (readinessPercentage < 40) {
        baseCost *= 1.0; // Full default value cost for unprepared companies
      }
      
      return Math.round(baseCost);
    }

    function createCostProjectionChart(readinessPercentage) {
      console.log('📊 Starting chart creation...');
      
      const exportVolume = parseInt(document.getElementById('export-volume').value) || 1000;
      const canvas = document.getElementById('projectionChart');
      
      if (!canvas) {
        console.error('❌ Canvas not found');
        return;
      }

      // Prepare data
      const years = Object.keys(carbonPrices);
      const preparedCosts = years.map(year => calculateEstimatedCosts(exportVolume, 80, parseInt(year)));
      const unpreparedCosts = years.map(year => calculateEstimatedCosts(exportVolume, 30, parseInt(year)));
      const userCosts = years.map(year => calculateEstimatedCosts(exportVolume, readinessPercentage, parseInt(year)));

      console.log('📊 Data prepared:', {years: years.length, userCosts: userCosts[0]});

      // Check if Chart.js is available
      if (typeof Chart === 'undefined') {
        console.log('⚠️ Chart.js not available, creating fallback table');
        createFallbackTable(canvas, years, preparedCosts, userCosts, unpreparedCosts, exportVolume, readinessPercentage);
        return;
      }

      try {
        const ctx = canvas.getContext('2d');
        
        // Destroy existing chart
        if (projectionChart && typeof projectionChart.destroy === 'function') {
          projectionChart.destroy();
        }

        // Create chart
        projectionChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: years,
            datasets: [{
              label: '✅ Prepared (80%+)',
              data: preparedCosts,
              borderColor: '#27ae60',
              backgroundColor: 'rgba(39, 174, 96, 0.1)',
              tension: 0.3,
              borderWidth: 3,
              pointRadius: 5
            }, {
              label: `📊 Your Company (${readinessPercentage}%)`,
              data: userCosts,
              borderColor: '#060496',
              backgroundColor: 'rgba(6, 4, 150, 0.2)',
              tension: 0.3,
              borderWidth: 4,
              pointRadius: 7,
              pointBackgroundColor: '#060496'
            }, {
              label: '❌ Unprepared (30%)',
              data: unpreparedCosts,
              borderColor: '#e74c3c',
              backgroundColor: 'rgba(231, 76, 60, 0.1)',
              tension: 0.3,
              borderWidth: 3,
              pointRadius: 5
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: `💰 CBAM Costs for ${exportVolume.toLocaleString()} tons/year - ${getSectorName(selectedSector)}`,
                font: { size: 14, weight: 'bold' },
                color: '#060496'
              },
              legend: {
                position: 'top',
                labels: { font: { size: 11 } }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Annual Cost (€)' },
                ticks: {
                  callback: function(value) {
                    return '€' + Math.round(value).toLocaleString();
                  }
                }
              },
              x: {
                title: { display: true, text: 'Year' }
              }
            }
          }
        });
        
        console.log('✅ Chart created successfully!');
        
      } catch (error) {
        console.error('❌ Chart creation failed:', error);
        createFallbackTable(canvas, years, preparedCosts, userCosts, unpreparedCosts, exportVolume, readinessPercentage);
      }
    }

    function createFallbackTable(canvas, years, preparedCosts, userCosts, unpreparedCosts, exportVolume, readinessPercentage) {
      console.log('📋 Creating fallback table...');
      
      const chartContainer = canvas.parentNode;
      chartContainer.innerHTML = `
        <div style="padding: 20px; text-align: center;">
          <h4 style="margin-bottom:20px; color:#060496;">
            💰 CBAM Costs for ${exportVolume.toLocaleString()} tons/year - ${getSectorName(selectedSector)}
          </h4>
          <div style="overflow-x: auto;">
            <table style="width:100%; min-width:600px; border-collapse:collapse; margin:0 auto; background:white; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
              <thead>
                <tr style="background:#060496; color:white;">
                  <th style="padding:12px; border:1px solid #ddd; font-weight:600;">Year</th>
                  <th style="padding:12px; border:1px solid #ddd; font-weight:600;">CO₂ Price</th>
                  <th style="padding:12px; border:1px solid #ddd; font-weight:600;">✅ Prepared</th>
                  <th style="padding:12px; border:1px solid #ddd; font-weight:600;">📊 Your Company (${readinessPercentage}%)</th>
                  <th style="padding:12px; border:1px solid #ddd; font-weight:600;">❌ Unprepared</th>
                </tr>
              </thead>
              <tbody>
                ${years.map((year, index) => `
                  <tr style="text-align:center; ${index % 2 === 0 ? 'background:#f8f9fa;' : ''}">
                    <td style="padding:10px; border:1px solid #ddd; font-weight:bold; color:#060496;">${year}</td>
                    <td style="padding:10px; border:1px solid #ddd;">€${carbonPrices[year]}/tCO₂</td>
                    <td style="padding:10px; border:1px solid #ddd; color:#27ae60; font-weight:600;">€${preparedCosts[index].toLocaleString()}</td>
                    <td style="padding:10px; border:1px solid #ddd; color:#060496; font-weight:bold; background:rgba(6,4,150,0.1);">€${userCosts[index].toLocaleString()}</td>
                    <td style="padding:10px; border:1px solid #ddd; color:#e74c3c; font-weight:600;">€${unpreparedCosts[index].toLocaleString()}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
          <div style="margin-top:15px; padding:10px; background:#f8f9fa; border-radius:8px; font-size:0.9em;">
            <p><strong>📈 Savings for prepared companies:</strong> €${Math.round((unpreparedCosts[0] - preparedCosts[0])).toLocaleString()} in 2026</p>
            <p><strong>📊 Cost increase 2026-2034:</strong> +${Math.round(((userCosts[8] - userCosts[0]) / userCosts[0]) * 100)}% for your company</p>
          </div>
        </div>
      `;
      
      console.log('✅ Fallback table created!');
    }

    function calculateReadinessScore(responses) {
      let score = 0;
      responses.forEach(response => {
        if (response.status === 'have') score += 2;
        else if (response.status === 'partial') score += 1;
      });
      const maxScore = responses.length * 2;
      return Math.round((score / maxScore) * 100);
    }

    function submitToGoogleSheets() {
      if (!validateInputs()) return;
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = '⏳ Sending...';
      
      // Collect all data
      const responses = collectSectorResponses();
      const score = calculateReadinessScore(responses);
      const exportVolume = parseInt(document.getElementById('export-volume').value);
      
      const companyData = {
        timestamp: new Date().toISOString(),
        companyName: document.getElementById('company-name').value,
        sector: selectedSector,
        sectorName: getSectorName(selectedSector),
        exportVolume: exportVolume,
        contactName: document.getElementById('contact-name').value,
        email: document.getElementById('contact-email').value,
        euBuyers: document.getElementById('eu-buyers').value || 'Not specified',
        readinessScore: score,
        readinessLevel: score >= 70 ? 'High' : score >= 40 ? 'Medium' : 'Low',
        estimatedCost2026: calculateEstimatedCosts(exportVolume, score, 2026),
        estimatedCost2030: calculateEstimatedCosts(exportVolume, score, 2030),
        estimatedCost2034: calculateEstimatedCosts(exportVolume, score, 2034),
        responses: JSON.stringify(responses)
      };
      
      // For demonstration - replace with actual Google Sheets URL
      console.log('Data to submit:', companyData);
      
      // Your Google Apps Script URL
      const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-VhRv-7oPC2b3HImELFmd_nYY6IZ6Eo8H3IWfpmIf88Z6CAY6RkFF9uZL5fBt7qkMlg/exec';

      // Make the request to Google Apps Script
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors', // Required for Google Apps Script
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(companyData)
      })
      .then(() => {
        // Note: no-cors mode means we can't read the response
        // So we assume success if no error is thrown
        submitBtn.textContent = '✅ Sent Successfully!';
        submitBtn.style.background = '#27ae60';

        alert(`✅ Analysis sent successfully!\n\n📊 Your results:\n- Readiness: ${score}%\n- 2026 Cost: €${calculateEstimatedCosts(exportVolume, score, 2026).toLocaleString()}\n\nAn expert from Entrenovu will contact you within 24 hours for free consultation.`);

        setTimeout(() => {
          submitBtn.disabled = false;
          submitBtn.textContent = '✉️ Send Results & Request Free Consultation';
          submitBtn.style.background = '#060496';
        }, 3000);
      })
      .catch(error => {
        console.error('Error submitting data:', error);
        submitBtn.textContent = '❌ Sending Error';
        submitBtn.style.background = '#e74c3c';

        alert('An error occurred while sending. Please try again.');

        setTimeout(() => {
          submitBtn.disabled = false;
          submitBtn.textContent = '✉️ Send Results & Request Free Consultation';
          submitBtn.style.background = '#060496';
        }, 3000);
      });
    }
  </script>
</body>
</html>
